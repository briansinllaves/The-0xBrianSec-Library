# How external resources access Azure Key Vault privately

A **private endpoint** gives your Key Vault a **private IP inside your Azure VNet**. That means:

- The Key Vault is **not reachable over the public internet**.
    
- It is reachable **only through that private IP**, via Azureâ€™s backbone network.
    

Because of that, **you never attach a public IP to a private endpoint**. Doing so would defeat the purpose of the private endpoint.

# ğŸŒ So how does an external (onâ€‘prem or thirdâ€‘party) resource connect?

You have **three valid options**, depending on your environment:

## **1. Siteâ€‘toâ€‘Site VPN**

If the external resource is onâ€‘premises:

- Create a VPN gateway in Azure.
    
- Connect your onâ€‘prem network to the Azure VNet containing the private endpoint.
    
- The external resource can now reach the Key Vaultâ€™s private IP.
    

## **2. ExpressRoute**

If you have enterprise connectivity:

- Use ExpressRoute with private peering.
    
- Your onâ€‘prem network becomes part of Azureâ€™s private address space.
    
- The Key Vault private endpoint becomes reachable.
    

## **3. Azure Private Link Service + Private Endpoint (for thirdâ€‘party SaaS)**

If the external resource is a partner/SaaS provider:

- They create a Private Link Service.
    
- You approve their connection.
    
- They access your Key Vault privately without public IPs.
    

# âŒ What you _cannot_ do

- You **cannot** expose the private endpoint through a public IP.
    
- You **cannot** NAT a public IP to a private endpoint.
    
- You **cannot** â€œwhitelistâ€ a public IP to reach a private endpoint.
    

Private endpoints are strictly private.

# What you _can_ do if you need public access

If you truly need public access (e.g., a thirdâ€‘party API that cannot use VPN/ExpressRoute):

- Keep the Key Vault public endpoint enabled.
    
- Use **firewall IP allowlists** to restrict access.
    
- Optionally use **Azure Front Door** or **Application Gateway** with WAF for additional control.
    

But this is separate from private endpoints.

## want an external workload pipeline to use az key vault

an **external workload pipeline** (GitHub Actions, GitLab, Jenkins, CircleCI, etc.) needs to pull secrets from **Azure Key Vault**, and you want to do it **securely**. This is a super common scenario, and the good news is: you _still donâ€™t_ create a public IP for a private endpoint.

# The core rule

**A private endpoint is only reachable over private network paths.** So an external pipeline can only reach it if you give that pipeline a private path into your Azure VNet.

There are **three supported architectures**.

#  Option 1 â€” Use a Public Key Vault Endpoint (simplest)

If your pipeline runs on a public cloud runner (GitHub-hosted, GitLab SaaS, etc.):

- Keep the Key Vault **public endpoint enabled**.
    
- Lock it down with:
    
    - **Firewall IP allowlist** (GitHub Actions IP ranges, etc.)
        
    - **Private endpoint for internal workloads** (optional)
        
    - **Access policies / RBAC**
        
    - **Managed identity federation** (best practice)
        

This is the most common setup because SaaS CI/CD runners **cannot** connect to your private network.

### When to choose this:

- Your pipeline runs on GitHub-hosted runners, GitLab SaaS, Azure DevOps Microsoft-hosted agents, etc.
    
- You want the simplest, fully supported approach.
    

# Option 2 â€” Use Workload Identity Federation (best practice for SaaS pipelines)

This avoids storing secrets in the pipeline entirely.

### How it works:

1. Your pipeline uses **OIDC federation** to authenticate to Azure AD.
    
2. Azure AD issues a token to the pipeline.
    
3. The pipeline uses that token to access Key Vault **over the public endpoint**.
    
4. No secrets, no service principals, no IP restrictions required.
    

Supported by:

- GitHub Actions
    
- GitLab CI
    
- CircleCI
    
- Azure DevOps (preview)
    

This is the most secure modern pattern.

# Option 3 â€” Give the pipeline private network access (advanced)

If your pipeline runs **selfâ€‘hosted** (VM, container, onâ€‘prem server), you can give it private access:

### You can use:

- **Siteâ€‘toâ€‘Site VPN**
    
- **ExpressRoute**
    
- **Azure VPN Client (Pointâ€‘toâ€‘Site)**
    
- **Selfâ€‘hosted runner inside your Azure VNet**
    

Once connected, the pipeline can reach the Key Vault **private endpoint IP** directly.

### When to choose this:

- You control the runner machine.
    
- You want _zero_ public exposure.
    
- You can manage networking.
    

# âŒ What you _cannot_ do

Just to be crystal clear:

- You **cannot** attach a public IP to a private endpoint.
    
- You **cannot** NAT a public IP to a private endpoint.
    
- You **cannot** let a SaaS pipeline reach a private endpoint without VPN/ExpressRoute.
    

Azure simply doesnâ€™t allow it.

# â­ My recommendation (based on what most teams do)

If your pipeline is **external SaaS** â†’ ğŸ‘‰ Use **Workload Identity Federation** + **public Key Vault endpoint** with firewall restrictions.

If your pipeline is **selfâ€‘hosted** â†’ ğŸ‘‰ Connect it to your VNet (VPN/ExpressRoute) and use the **private endpoint**.


# ğŸ” **Is a â€œpublic Key Vault endpointâ€ the same as a Key Vault public IP?**

**No â€” Azure Key Vault does** _**not**_ **have a public IP address.** Instead, it exposes a **public DNS name** that resolves to a Microsoftâ€‘owned, shared public IP range.

### âœ”ï¸ What a _public Key Vault endpoint_ actually is:

- A **publicly reachable DNS name**, like: `https://myvault.vault.azure.net/`
    
- Backed by **Azureâ€™s shared public infrastructure**, not a dedicated IP you manage.
    
- You cannot assign, view, or control a public IP for Key Vault.
    

### âœ”ï¸ What a _private endpoint_ is:

- A **private IP inside your VNet**, like: `10.1.2.4`
    
- Only reachable through private networking (VPN, ExpressRoute, VNet integration).
    

These two endpoints are **separate** and can exist at the same time.

# ğŸ§  Why this matters for your external pipeline

If your pipeline is external (GitHub Actions, GitLab SaaS, CircleCI, etc.):

- It **cannot** reach your private endpoint.
    
- It **can** reach the **public Key Vault endpoint**.
    
- You secure it using:
    
    - Firewall IP allowlists (optional)
        
    - Access policies or RBAC
        
    - **Workload Identity Federation (best practice)**
        

This is the standard, recommended pattern for SaaS CI/CD.

# ğŸ§© Quick comparison

|Feature|Public Endpoint|Private Endpoint|
|---|---|---|
|Has a public IP you manage|âŒ No|âŒ No|
|Reachable from internet|âœ”ï¸ Yes|âŒ No|
|Reachable from VNet|âœ”ï¸ Yes|âœ”ï¸ Yes|
|Requires VPN/ExpressRoute|âŒ No|âœ”ï¸ Yes|
|Best for external pipelines|âœ”ï¸ Yes|âŒ No|

# â­ Bottom line

A **public Key Vault endpoint is NOT a public IP**. Itâ€™s simply the default public DNS endpoint that Azure exposes for all Key Vaults.

**workload identity federation is implemented in Azure AD using an External ID (federated identity credential)**. 
# ğŸ” What workload identity federation _actually_ is

Workload identity federation lets an external system (like GitHub Actions, GitLab CI, Jenkins, or any OIDCâ€‘capable platform) authenticate to Azure **without storing secrets**.

Instead of a client secret, Azure AD trusts a **token issued by an external identity provider**.

That trust relationship is configured in Azure AD as a:

### âœ”ï¸ **Federated Identity Credential**

This is the object that Azure AD stores under an app registration.

It tells Azure AD:

- which external identity provider to trust (GitHub, GitLab, etc.)
    
- which issuer URL to expect
    
- which subject (pipeline/job/runner) is allowed
    
- which audiences are valid
    

This is what Azure calls an **External ID**.

# How it fits together

### **1. You create an App Registration in Azure AD**

This represents your pipeline workload.

### **2. You add a â€œFederated Identity Credentialâ€**

This is the â€œexternal IDâ€ youâ€™re asking about.

It defines:

- **Issuer** (e.g., `https://token.actions.githubusercontent.com`)
    
- **Subject** (e.g., a GitHub repo or workflow)
    
- **Audience** (usually `api://AzureADTokenExchange`)
    

### **3. Your pipeline requests an OIDC token from its platform**

GitHub â†’ GitHub OIDC GitLab â†’ GitLab OIDC etc.

### **4. Azure AD validates that token using the External ID config**

If it matches, Azure AD issues an Azure access token.

### **5. The pipeline uses that token to access Key Vault**

No secrets stored anywhere.

# So to answer your question directly:

### âœ”ï¸ **Yes â€” workload identity federation uses an External ID (federated identity credential) in Azure AD.**

That External ID is what links your external pipeline to Azure AD securely.