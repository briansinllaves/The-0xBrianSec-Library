# COM Hijacking

## Description
COM Hijacking is a technique that leverages the Windows Component Object Model (COM) system to achieve code execution or persistence. When an application attempts to create a COM object using a Class ID (CLSID), Windows checks specific registry keys to determine which binary to load. If an attacker can modify these keys—especially under user-writable hives like `HKCU\Software\Classes\CLSID`—they can redirect the system to load a malicious DLL instead.

This tactic is stealthy and typically abused for persistence, since COM objects are used by many legitimate system and application processes. It maps to **MITRE ATT&CK T1546.015** (Event Triggered Execution: Component Object Model Hijacking), is categorized under **CWE-94** (Improper Control of Code Generation), and violates **NIST SI-10**, which emphasizes proper validation of execution and configuration paths.

Attackers prefer COM Hijacking because it blends into normal system behavior and doesn’t always require file drops or new services. It is often triggered automatically by trusted applications during startup or user login.

## How to Identify
Monitor registry operations using **Procmon** or **Sysmon Event ID 13** to catch modifications under `HKCU\Software\Classes\CLSID`. Pay close attention to the `InprocServer32`, `LocalServer32`, and `TreatAs` subkeys—modifications here may indicate hijack attempts.

Run **Autoruns** to review COM objects set to auto-load during login or at system boot. Compare entries under `HKCU` and `HKLM`, looking for user-controlled values that override system-wide configurations. Check for unsigned or suspicious DLLs referenced in the `InprocServer32` path.

Perform threat hunting on commonly abused CLSIDs, which are documented in threat intelligence feeds and red team tools. Combine this with `reg query` and PowerShell scripts to audit current user COM registration entries.

## Defense Recommendations
Prevent low-privileged users from writing to CLSID registry keys. Apply Group Policy to lock down registry access, especially under `HKCU\Software\Classes` and related COM object paths. Monitor all registry writes to COM-related keys and flag changes outside of software installations or updates.

Use **AppLocker** or **Windows Defender Application Control** to block unsigned or unknown DLLs from loading via COM interfaces. Registry integrity monitoring tools can alert defenders when a COM object has been redirected to a suspicious binary.

Audit the COM usage of privileged or auto-elevated binaries like `CompMgmtLauncher.exe`. If any of these are vulnerable to hijack, they must be remediated or isolated. Apply **NIST AC-6** to enforce least privilege and prevent user-controlled redirection paths from being abused by trusted system components.

Perform regular sweeps for anomalies in `HKCU\Software\Classes\CLSID`. Red team exercises can validate whether common COM hijack paths are monitored or blocked. As part of secure development and deployment, software vendors should avoid using COM if unnecessary, or register CLSIDs only under secured system-wide keys.
