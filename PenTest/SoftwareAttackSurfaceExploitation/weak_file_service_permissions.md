# Weak File and Service Permissions

## Description
Weak file and service permissions occur when critical system files, service binaries, or registry keys are writable by low-privileged users. This misconfiguration allows attackers to replace or modify executables or scripts used by Windows services, enabling privilege escalation during service start or reboot. It also applies to permissions on service configurations that allow changes to the serviceâ€™s executable path or settings.

This issue aligns with **MITRE ATT&CK T1574.011** (Hijack Execution Flow: Services File Permissions Weakness), **CWE-732** (Incorrect Permission Assignment for Critical Resource), and violates **NIST 800-53 AC-6** (Least Privilege) and **CM-7** (Least Functionality) by exposing elevated components to unauthorized access.

## How to Identify
Use `accesschk.exe` from Sysinternals to enumerate services and check if any service binaries, directories, or registry keys under `HKLM\SYSTEM\CurrentControlSet\Services` are writable by non-admin users. 

Example:
```bash
accesschk.exe -uwcqv "Users" "C:\Program Files\"
accesschk.exe -uwcqv "Users" -s "HKLM\SYSTEM\CurrentControlSet\Services"
```

Also check service permissions:
```bash
accesschk.exe -uwcqv "Users" -s SCManager
```

Look for any `WRITE_DAC`, `WRITE_OWNER`, or `SERVICE_CHANGE_CONFIG` permissions. Use `sc qc <service>` to review service binary paths, and validate access rights with `icacls`.

## Defense Recommendations
Ensure all services and their binaries are owned by SYSTEM or Administrators and are not writable by standard users. Regularly audit permissions using automated tools like **CIS-CAT**, **OpenSCAP**, or custom scripts with `accesschk` and `PowerShell`.

Enforce **Group Policy Objects (GPOs)** that explicitly deny write access to system paths such as `C:\Program Files`, `C:\Windows`, and sensitive service registry keys. Apply software restriction policies to block execution from user-writable paths.

For any services that require updates or temp files, redirect their write operations to isolated directories with controlled access. Limit user group privileges and use **security templates** to reapply hardened permissions across systems.

Auditing changes to services and critical file paths with tools like **Sysmon**, **Windows Event Forwarding**, or **MDAC** helps catch abuse attempts early. Combine this with endpoint protection rules targeting changes in service paths or file integrity violations.

