# Token Impersonation

## Description
Token impersonation is a technique where attackers hijack or reuse access tokens from privileged processes to elevate their permissions. Windows access tokens represent a userâ€™s identity. If a high-privilege process impersonates a user but leaves the token accessible, a local attacker may duplicate it and gain SYSTEM-level access.

This method maps to **MITRE ATT&CK T1134.001** (Access Token Manipulation: Token Impersonation), fits **CWE-269** (Improper Privilege Management), and contradicts **NIST AC-6** (Least Privilege).

## How to Identify
Monitor for `OpenProcess`, `OpenProcessToken`, and `DuplicateTokenEx` calls, especially when made by non-SYSTEM processes targeting higher-integrity processes.

Use **Process Explorer** or `whoami /groups` to enumerate token privileges. Tools like **Incognito**, **Rubeus**, or **Mimikatz** can test for token impersonation opportunities.

Check process access tokens via `GetTokenInformation()` to validate what groups and privileges are available.

## Defense Recommendations
Disable token duplication where unnecessary. Use restricted tokens when impersonation is required. Ensure least privilege and user isolation policies are enforced via Group Policy.

Log token usage events via **Sysmon Event ID 10** and alert on duplication between privilege boundaries. Protect SYSTEM processes from being accessed by unprivileged users.

Follow **NIST AC-6** by assigning tokens explicitly and avoiding unrestricted impersonation capabilities in services or scripts. Audit token creation paths and isolate high-integrity services from user context.

