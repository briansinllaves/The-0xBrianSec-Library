# Handle Hijacking

## Description
Handle hijacking is a software exploitation technique that targets Windows handles left exposed by privileged processes. When a process opens a handle (file, registry key, token, etc.), that handle may remain accessible to child processes or threads, especially if `bInheritHandle` is not set properly. Attackers can use system tools or code to duplicate or access these handles, leading to privilege escalation or unauthorized access.

This is closely related to **MITRE ATT&CK T1574.002**, linked to **CWE-668** (Exposure of Resource to Wrong Sphere), and violates **NIST AC-6** by exposing high-privilege resources to low-privilege users.

## How to Identify
Use **Process Hacker**, **Process Explorer**, or **Handle.exe** to inspect which handles are open by processes. Look for SYSTEM or Admin-level processes exposing handles that child or lower-integrity processes inherit.

Monitor `NtDuplicateObject`, `OpenProcess`, or `DuplicateHandle` system calls using **Sysmon Event ID 10** or EDR tools. Focus on low-privilege processes accessing handles to privileged objects.

Check for services that start child processes without explicitly disabling handle inheritance. These often leak token, section, or file handles.

## Defense Recommendations
Ensure that sensitive handles are not inheritable unless explicitly required. Use secure APIs and explicitly set `bInheritHandle = FALSE` for handle creation. Isolate service and user context in different sessions or job objects.

Enable process mitigations like `PROC_THREAD_ATTRIBUTE_HANDLE_LIST` to prevent handle inheritance. Audit service code and startup parameters to ensure no privileged handles are leaked across boundaries.

Enforce **NIST AC-6** by limiting access to handles through strict access control descriptors and avoiding unnecessary inter-process communication between users of different privilege levels. Log and monitor handle duplication events and terminate suspicious cross-session handle access.

