# Named Pipe Abuse

## Description
Named pipes are a mechanism for inter-process communication (IPC) in Windows. When a privileged service exposes a named pipe without strong access control, attackers may connect to it and send crafted data or impersonate privileged clients. This may result in privilege escalation or code execution if the pipe handler fails to validate input or impersonation tokens.

This technique aligns with **MITRE ATT&CK T1040** (Network Sniffing or Named Pipe Communication), **CWE-269** (Improper Privilege Management), and violates **NIST AC-3**, which requires enforcement of proper access control policies for system-level interactions.

## How to Identify
List named pipes with tools like **Sysinternals PipeList**, `Get-ChildItem \.\pipe\`, or **WinObj**. Use **Procmon** to trace pipe creation and communication behavior. Identify which services or apps open pipes and who can access them.

Check if any named pipes are writable or connectable by non-administrators. Use tools like **Impacket's smbexec**, **Incognito**, or **RoguePotato** to test for impersonation or relay attacks via token abuse.

Audit code or binaries that use `CreateNamedPipe` and `ImpersonateNamedPipeClient` without proper security descriptors or impersonation validation logic.

## Defense Recommendations
Secure named pipes with proper Discretionary Access Control Lists (DACLs). Ensure only authorized users can create or connect to critical pipes.

Use impersonation APIs carefully. After calling `ImpersonateNamedPipeClient`, verify the caller's identity using `OpenThreadToken` and `GetTokenInformation`. Avoid relying on pipe data alone for authorization.

Audit pipe creation and usage via Sysmon and EDR logs. Monitor for unauthorized connections to privileged service pipes. From a compliance standpoint, enforce NIST AC-3 and AC-6 by isolating sensitive IPC channels and applying the principle of least privilege.

