# Code Signing

## Slide 1

Code Signing

## Slide 2

Code signing

Code signing is a mechanism of proving the identity of the software developer and verify the code has not been tampered with
Historically, signed code is treated with a different level of trust by security products
Examples:
Signing your code with a valid Extended Validation Code Signing certificate automatically provides a reputation with MS SmartScreen
Starting with Windows 10, kernel drivers must be signed
Most AV products offer the ability to excluded scanning of files signed with a specific certificate
Adversaries often abuse code signing certs and it is becoming more common for IR teams to find malware signed with stolen certificates

## Slide 3

Code signing in the wild

BlackTech signed malware with stolen certs from D-Link
Stuxnet components signed with stolen certificates
Duqu used certificates stolen from Foxconn to deploy malware during the Kapersky compromise
Winnti signed malware with stolen certificate from a video game developer
Operation ShadowHammer, a supply chain attack, utilized two ASUS code signing certificates as part of the backdoor process
OilRig signed malware with stolen certificate in an attack on a university
Multiple chinese APT groups found attacking adware developers to obtain code signing certificates

## Slide 4

Obtaining a code signing cert

Purchase a code signing cert from a vendor (Note there are different types offered, with EV certs requiring the vendor to verify items such as the physical address of the business and the requester to provide various levels of documentation)
Most time consuming and attribution concerns
Target developers/devops systems to obtain a code signing cert
Prefered method often reported for adversaries
Leaked certificates (Dell, Lenovo, file/code sharing sites, etc.)
Easiest, but no guarantees the certificate is not expired or already revoked

## Slide 5

Signing a file with signtool 

Signtool is available on Windows as part of the SDK
Example usage:
signtool.exe sign /t http://timestamp.verisign.com/scripts/timestamp.dll /a /f cert.pfx /p "password" malware.exe

## Slide 6

Signing a file with ossligncode 

A combination of openssl and ossligncode can be used to sign files on linux
Overview:
Convert pfx into a cer file using openssl
Create a private key in pem format using openssl
Sign the file using ossligncode

## Slide 7

Signing a file with ossligncode 

Convert pfx into a cer file using openssl. When prompted for the password, enter the import password associated with the certificate
openssl pkcs12 -in cert.pfx -out cert.cer -nodes
Create a private key in pem format using openssl. The import password is the same password used in the previous step. The PEM pass phrase can be anything you choose
openssl pkcs12 -in cert.pfx -nocerts -out PrivateKey.pem
Sign the file using ossligncode
osslsigncode -certs cert.cer -key PrivateKey.pem -n "Application Name" -in file.exe -out file\_signed.exe -pass “”

## Slide 8

Verifying the signature 

If successfully signed, the properties of the file will now contain a digital signature tab

![Slide Image](../../assets/Code_Signing_images/slide8_img2.png)

