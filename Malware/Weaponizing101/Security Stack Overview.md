# Security Stack Overview

## Slide 1

Security Stack Overview

## Slide 2

Cylance

Summary
EDR
Userland
Unprotected processes
Issues
Load another NTDLL into process and use functions to bypass
Block DLLs other than Microsoft-signed
Excluded paths, files, and processes
Driver tampering
File tampering (DLLs, etc)
Unhooking (e.g. Syswhisper)

Path
C:\ProgramData\Cylance
C:\Program Files\Cylance
Processes
C:\Program Files\Cylance\Desktop\CylanceSvc.exe
C:\Program Files\Cylance\Desktop\CylanceUI.exe
C:\Program Files\Cylance\Desktop\CyUpdate.exe

## Slide 3

MDE

Summary
EDR
AV
Protected processes
Kernel (PSP notify, ETW, Signature scanning, Heuristics, Sandbox, Compliance checks)
Issues
Excluded paths, files, extensions and processes
Anti-Sandbox/Heuristics
TO DO
Bypass with Load Library
Overwrite datastream for Log buffer
Hook network comms with Azure (warning: health check after 7 days)

Path
C:\ProgramData\Microsoft\Windows Defender\
C:\Program Files\Windows Defender Advanced Threat Protection\
C:\Program Files\Windows Defender\
Processes
C:\ProgramData\Microsoft\Windows Defender\Platform\######\MsMpEng.exe
C:\Program Files\Windows Defender Advanced Threat Protection\SenseNdr.exe
C:\Program Files\Windows Defender Advanced Threat Protection\Classification\SenseCE.exe
C:\Program Files\Windows Defender Advanced Threat Protection\MsSense.exe

## Slide 4

Digital Guardian

Summary
DLP
Several components
HP component
Third-party software (DLLs and Plugins: i.e. kvoop)
Driver
Kernel and userland
Bypasses
Tamper with driver

Path
C:\Program Files\DgAgent
C:\ProgramData\DGAgent
Processes
C:\Program Files\DgAgent\DgAdmin.exe
C:\Program Files\DgAgent\DgAgent.exe
C:\Program Files\DgAgent\DgPrompt.exe
C:\Program Files\DgAgent\DgService.exe
C:\Program Files\DgAgent\DgWip.exe

## Slide 5

Uber Agent

Summary
Splunk add-on
Metrics (e.g. performance, diagnostics)
Networking (i.e. DNS, IP addresses, URLs)
Restricted Driver
Issues
Rename license file in ProgramData
Socket theft
Modify log file on disk

Path
C:\Program Files\vast limits\uberAgent
C:\ProgramData\vast limits\uberAgent
Processes
C:\Program Files\vast limits\uberAgent\uberAgent.exe
C:\Program Files\vast limits\uberAgent\uAInSessionHelper.exe

## Slide 6

Thycotic

Summary
Access Control (Elevation & Restriction)
Driver (ArelliaSvc)
Heavily customized for PwC
Issues
Excluded processes, paths, metadata (sqlite DB)
COM Object Elevation (historical)
Terminate process
Token theft (All privileges)
TO DO
Named Pipe hijacking (communicates to Driver/service via NamedPipe)

Path
C:\Program Files\Thycotic
C:\ProgramData\Arellia
C:\ProgramData\Thycotic
Processes
C:\Program Files\Thycotic\Agents\ApplicationControl\ArelliaACSvc.exe
C:\Program Files\Thycotic\Agents\Agent\Arellia.Agent.Service.exe
C:\Program Files\Thycotic\Agents\ApplicationControl\ArelliaDisplayXamlAction.exe

## Slide 7

Splunk

Summary
Logging
Userland
Runs scripts (i.e. PowerShell)
Issues
Hooking other products that send to Splunk
Hooking via Process Injection Splunk logs outbound (e.g. specific keywords)
DLL Hijacking
TO DO
Polish up Splunk log hooking (outbound log chunks might send partials on keyword match)

Path
C:\Program Files\SplunkUniversalForwarder
Processes
C:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe
C:\Program Files\SplunkUniversalForwarder\bin\splunk-powershell.exe
C:\Program Files\SplunkUniversalForwarder\bin\splunk-regmon.exe
C:\Program Files\SplunkUniversalForwarder\bin\splunk-winevtlog.exe
….

## Slide 8

Palo Alto GlobalProtect

Summary
VPN
Logs
Compliance Checks
HIP Check (new systems connecting to GP)
Issues
COM Object Hijacking
VPN Certificate Theft to connect to VPN

Path
C:\Program Files\Palo Alto Networks\GlobalProtect\
C:\Users\\AppData\Local\Palo Alto Networks\GlobalProtect
Processes
C:\Program Files\Palo Alto Networks\GlobalProtect\PanGPA.exe
C:\Program Files\Palo Alto Networks\GlobalProtect\PanGPS.exe

## Slide 9

Palo Alto Twistlock

Summary
Container Security
Configuration Compliance

## Slide 10

Connected MX

Summary
Backup Software
Userland (Service)
Issues
Privilege Escalation (traffic replay to modify file privileges)
World writable VBS script (Historical)
DLL injection privilege escalation (Used twice already)
TO DO
Process dump for API key to steal backups of compromised users/systems

Path
C:\Program Files\Connected MX
C:\Users\\AppData\Local\Connected MX
C:\ProgramData\Connected MX
Processes
C:\Program Files\Connected MX\ConnectedMXService.exe
C:\Program Files\Connected MX\ConnectedMXSystemTrayUI.exe

## Slide 11

Bitlocker

Summary
Full disk encryption
Pre-boot
Issues
Out-of-band Key theft (i.e. Compressed air)

## Slide 12

Qualys

Summary
Vulnerability scanning
Agent
Asset Inventory
Compliance checks
Excluded process (Historically used on Operations)
Issues
DLL Hijacking
TO DO
Obtain Qualys agent credentials (maybe memory dump, registry, files on disk?)

Path
C:\Program Files\Qualys
C:\ProgramData\Qualys
Processes
"C:\ProgramData\Qualys\QualysAgent\Correlation\Resources\agentid-service.exe" -config "C:\ProgramData\Qualys\QualysAgent\Correlation\Resources\service\_config.json"
C:\Program Files\Qualys\QualysAgent\QualysAgent.exe

## Slide 13

OSQuery

Summary
macOS detection/alerting
TO DO
Tampering with agent (i.e. escalate and stop, hijack logging)

## Slide 14

auditd

Summary
linux detection/alerting
Issues
Very specific rules for binary/file access

## Slide 15

Flexera

Summary
Managed device software/Asset Management
Logging forwarded to Splunk
Issues
Privilege Escalation via Symlink on Linux (Historical)
TO DO
Look further into for potential priv esc/persistence
“Encrypted” credentials on disk

Path
C:\Program Files (x86)\ManageSoft\
C:\ProgramData\ManageSoft Corp\ManageSoft
Processes
C:\Program Files (x86)\ManageSoft\Schedule Agent\ndinit.exe
C:\Program Files (x86)\ManageSoft\Schedule Agent\ndtask.exe

## Slide 16

WorkspaceONE/Airwatch

Summary
Managed device
Software management
Device provisioning (macOS)
32-bit (Windows)
Was Defender and Cylance excluded process in the past
Issues
Historically, creds stored in scripts on disk (macOS)
Dylib Hijacking (macOS)
COM object/DLL hijacking (Historical)
TO DO
Look into for privilege escalation, mobile device compromise, persistence

Path
C:\Program Files (x86)\Airwatch
C:\Program Files\Workspace ONE Assist
Processes
C:\Program Files (x86)\Airwatch\AgentUI\AWACMClient.exe
C:\Program Files (x86)\Airwatch\AgentUI\AwWindowsIpc.exe
C:\Program Files\Workspace ONE Assist\WorkspaceONE.Assist.Agent.exe
C:\Program Files\Workspace ONE Assist\WorkspaceONE.Assist.Service.exe

## Slide 17

Entrust

Summary
Multi Factor Authentication Token Software
Issues
DPAPI decrypt token (Encrypted key and PIN in registry)
C# 

Path
C:\Program Files (x86)\Entrust
C:\Users\\AppData\Local\Entrust
Processes
C:\Program Files (x86)\Entrust\IdentityGuard Soft Token\SoftToken.exe

## Slide 18

raPROv2

Summary
Device and User Certificate Provisioning Software
Custom for PwC
Sends email notification from user once certificates are requested (unavoidable)
Only possible to request certificates if connected to internal network
Issues
C#
Reverse engineered process to allow certificate request with any compromised user credentials from an internal system
Flip byte in CSR to allow export of certificates from Windows certificate store

Path
C:\Program Files (x86)\raPROv2
C:\ProgramData\raPROv2
Processes
C:\Program Files (x86)\raPROv2\PwC\_RA.exe

## Slide 19

LocalAccountEncrypter

Summary
Old Software used to encrypt/decrypt local administrator account (may not be used anymore, but exists on systems)
Custom for PwC
Issues
Runs as System
Scheduled Task runs on boot
DLL Hijacking

