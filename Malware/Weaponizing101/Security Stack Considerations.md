# Security Stack Discovery & Enumeration

## Introduction

Understanding the security stack deployed on a target system is a critical phase in offensive operations. Enumerating endpoint security controls, their components, and potential weaknesses enables attackers to plan evasion, privilege escalation, or persistence techniques. This overview summarizes common discovery tactics, typical security stack layers, and historical bypass conceptsâ€”without referencing specific vendors or products.

---

## Security Stack Layers

Modern endpoints often employ a layered security approach, which may include:

- **Endpoint Detection and Response (EDR):** Monitors process, memory, and file activity; may use userland hooks or kernel drivers.
- **Antivirus (AV):** Scans files and processes for known signatures and suspicious behaviors.
- **Data Loss Prevention (DLP):** Monitors and restricts data movement, often with userland and kernel components.
- **Access Control & Privilege Management:** Enforces application whitelisting, elevation restrictions, and policy enforcement.
- **Backup & Recovery Agents:** Provide data protection, sometimes with privileged services.
- **Device & Asset Management:** Inventory, compliance, and software deployment agents.
- **Logging & Monitoring Agents:** Collect and forward logs, sometimes running scripts or injecting into processes.
- **Disk Encryption:** Full disk or file-level encryption, often with pre-boot authentication.
- **Vulnerability Scanners:** Periodically scan for misconfigurations or missing patches.
- **Container/Cloud Security Agents:** Monitor and enforce compliance in virtualized or containerized environments.

---

## Discovery Techniques

Attackers may use the following methods to enumerate security stack components:

- **File System Enumeration:** Search for known installation directories, agent binaries, configuration files, and logs.
- **Process Enumeration:** List running processes and services to identify security agents and their components.
- **Driver Enumeration:** Query loaded kernel drivers to detect security modules operating at the kernel level.
- **Registry Inspection:** Check for service registrations, configuration settings, and persistence mechanisms.
- **Network Connections:** Identify agents communicating with cloud or management servers.
- **Scripted Discovery:** Use PowerShell, WMI, or CLI tools to automate enumeration of services, drivers, and scheduled tasks.

---

## Common Weaknesses & Bypass Concepts

Security products may have weaknesses or misconfigurations that can be exploited, such as:

- **Userland Hooking:** Many security controls rely on userland API hooks, which can be bypassed by loading clean copies of system libraries or unhooking APIs.
- **Unprotected Processes:** Some agent processes may lack protection, allowing tampering or injection.
- **Excluded Paths/Processes:** Misconfigured exclusions can allow malicious files or processes to evade detection.
- **Driver Tampering:** Weaknesses in kernel drivers may allow disabling or bypassing security controls.
- **DLL Hijacking/Injection:** Insecure loading of libraries by privileged services can enable code execution.
- **Privilege Escalation:** Backup, management, or legacy agents may have vulnerabilities allowing elevation of privileges.
- **Token or Credential Theft:** Agents may store sensitive credentials insecurely (e.g., in memory, registry, or files).
- **Named Pipe/IPC Hijacking:** Inter-process communication channels may be susceptible to hijacking or spoofing.
- **Log Tampering:** Attackers may attempt to modify or suppress logs to evade detection.
- **Sandbox/Heuristic Evasion:** Techniques to detect or evade behavioral analysis and sandboxes.
- **World Writable Files/Scripts:** Misconfigured permissions on scripts or binaries can allow unauthorized modification.

---

## Enumeration & Bypass Workflow (Example)

1. **Enumerate Security Controls:**
   - Use PowerShell or CLI to list running services, drivers, and scheduled tasks.
   - Search common installation paths for agent binaries and configuration files.
   - Inspect registry for service and driver registrations.

2. **Analyze Agent Components:**
   - Identify userland vs. kernel components.
   - Check for process protection, code signing, and privilege levels.
   - Review configuration for exclusions or weak policies.

3. **Identify Potential Weaknesses:**
   - Look for unprotected or misconfigured processes.
   - Search for world-writable files or scripts.
   - Check for insecure inter-process communication.

4. **Plan Evasion or Exploitation:**
   - Consider unhooking APIs, injecting into unprotected processes, or exploiting DLL hijacking.
   - Target excluded paths or processes for payload execution.
   - Attempt to escalate privileges via agent vulnerabilities.

---

## Notes

- Security stack enumeration is an ongoing process; new agents or updates may introduce new weaknesses.
- Many bypass techniques rely on a deep understanding of Windows internals, process/thread manipulation, and privilege boundaries.
- Always validate findings in a controlled environment before attempting on production systems.
- Check logs, libraries

---
